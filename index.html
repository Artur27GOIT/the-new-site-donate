<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>–û—Å–æ–±–∏—Å—Ç–∞ –ø–æ–¥—è–∫–∞</title>
    <link rel="stylesheet" href="./style/style.css" />
  </head>
  <body>
    <main class="card" role="main" aria-label="–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø–æ–¥—è–∫–∏">
      <h1>
        –û—Å–æ–±–∏—Å—Ç–∞ –ø–æ–¥—è–∫–∞ –≤—ñ–¥ –º–µ–Ω–µ, —â–æ —Å—Ç–∞–ª–∏ —á–∞—Å—Ç–∏–Ω–æ—é –∑–±–æ—Ä—É<br />
        –†–∞–∑–æ–º –¥–æ –º–∏—Ä—É
      </h1>
      <span class="element-heart">‚ù§Ô∏è‚Äçü©π</span>
      <div class="container-button">
        <button class="donate-btn" id="openModalBtn">–ó–∞–¥–æ–Ω–∞—Ç–∏—Ç–∏</button>
      </div>
      <!---------------------------------------- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ---------------------------------------      -->
      <div class="modal" id="donateModal">
        <div class="modal-content">
          <span class="close-btn" id="closeModalBtn">&times;</span>
          <h2>–í–∑—è—Ç–∏ —É—á–∞—Å—Ç—å —É —Ä–æ–∑—ñ–≥—Ä–∞—à—ñ</h2>

          <form
            class="donate-form"
            id="googleForm"
            action="https://script.google.com/macros/s/AKfycbxp-51Z59AwnGMbWk1hKoanZU5wA4v5n_yr-l_gyg-IPWmbFV7aUQTftbo8jk-s1mgf/exec
"
            method="POST"
          >
            <label for="firstName">–Ü–º‚Äô—è</label>
            <input
              type="text"
              id="firstName"
              name="firstName"
              placeholder="–í–≤–µ–¥—ñ—Ç—å –≤–∞—à–µ —ñ–º‚Äô—è"
              required
            />

            <label for="lastName">–ü—Ä—ñ–∑–≤–∏—â–µ</label>
            <input
              type="text"
              id="lastName"
              name="lastName"
              placeholder="–í–≤–µ–¥—ñ—Ç—å –≤–∞—à–µ –ø—Ä—ñ–∑–≤–∏—â–µ"
              required
            />

            <label for="amount">–°—É–º–∞ –¥–æ–Ω–∞—Ç—É (–≥—Ä–Ω)</label>
            <input
              type="number"
              id="amount"
              name="amount"
              placeholder="50"
              min="50"
              step="50"
              required
            />

            <label>–ù–æ–º–µ—Ä –±—ñ–ª–µ—Ç—É</label>
            <div class="ticket-grid">
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="1" />
                <span>1</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="2" />
                <span>2</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="3" />
                <span>3</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="4" />
                <span>4</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="5" />
                <span>5</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="6" />
                <span>6</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="7" />
                <span>7</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="8" />
                <span>8</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="9" />
                <span>9</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="10" />
                <span>10</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="11" />
                <span>11</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="12" />
                <span>12</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="13" />
                <span>13</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="14" />
                <span>14</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="15" />
                <span>15</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="16" />
                <span>16</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="17" />
                <span>17</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="18" />
                <span>18</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="19" />
                <span>19</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="20" />
                <span>20</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="21" />
                <span>21</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="22" />
                <span>22</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="23" />
                <span>23</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="24" />
                <span>24</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="25" />
                <span>25</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="26" />
                <span>26</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="27" />
                <span>27</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="28" />
                <span>28</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="29" />
                <span>29</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="30" />
                <span>30</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="31" />
                <span>31</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="32" />
                <span>32</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="33" />
                <span>33</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="34" />
                <span>34</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="35" />
                <span>35</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="36" />
                <span>36</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="37" />
                <span>37</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="38" />
                <span>38</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="39" />
                <span>39</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="40" />
                <span>40</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="41" />
                <span>41</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="42" />
                <span>42</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="43" />
                <span>43</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="44" />
                <span>44</span>
              </label>
              <label class="ticket">
                <input type="checkbox" name="ticketNumber" value="45" />
                <span>45</span>
              </label>
            </div>

            <button type="submit" class="submit-btn">–í–∑—è—Ç–∏ —É—á–∞—Å—Ç—å</button>
          </form>
        </div>
      </div>
    </main>
    <!-- —Å–∫—Ä—ñ–ø—Ç –º–æ–¥–∞–ª–∫–∏ -->
    <script>
      const donateBtn = document.getElementById("openModalBtn");
      const closeModal = document.getElementById("closeModalBtn");
      const modal = document.getElementById("donateModal");

      const donateForm = document.querySelector(".donate-form");
      const amountInput = document.getElementById("amount");
      const ticketCheckboxes = document.querySelectorAll(
        'input[name="ticketNumber"]'
      );

      const monoJarLink = "https://send.monobank.ua/jar/2pDvqLCWa2";

      // ===== –í—ñ–¥–∫—Ä–∏—Ç—Ç—è / –∑–∞–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª–∫–∏ =====
      donateBtn.addEventListener("click", () => modal.classList.add("active"));
      closeModal.addEventListener("click", () =>
        modal.classList.remove("active")
      );
      window.addEventListener("click", (e) => {
        if (e.target === modal) modal.classList.remove("active");
      });

      // ===== –û–±–º–µ–∂–µ–Ω–Ω—è –±—ñ–ª–µ—Ç—ñ–≤ –ø–æ —Å—É–º—ñ =====
      function updateTicketAvailability() {
        const amount = parseInt(amountInput.value);
        const maxTickets = Math.floor(amount / 50);

        if (isNaN(amount) || amount < 50) {
          ticketCheckboxes.forEach((cb) => {
            cb.checked = false;
            cb.disabled = true;
          });
          return;
        }

        const checkedCount = Array.from(ticketCheckboxes).filter(
          (cb) => cb.checked
        ).length;

        ticketCheckboxes.forEach((cb) => {
          if (!cb.checked && checkedCount >= maxTickets) cb.disabled = true;
          else cb.disabled = false;
        });
      }

      amountInput.addEventListener("input", updateTicketAvailability);
      ticketCheckboxes.forEach((cb) =>
        cb.addEventListener("change", updateTicketAvailability)
      );

      // ===== Submit —Ñ–æ—Ä–º–∏ =====
      donateForm.addEventListener("submit", async (e) => {
        // <- –¥–æ–¥–∞–Ω–æ async
        e.preventDefault();

        const firstName = document.getElementById("firstName").value.trim();
        const lastName = document.getElementById("lastName").value.trim();
        const amount = parseInt(document.getElementById("amount").value) || 0;

        const selectedTickets = Array.from(ticketCheckboxes)
          .filter((cb) => cb.checked)
          .map((cb) => cb.value);

        // ===== –ü–µ—Ä–µ–≤—ñ—Ä–∫–∏ =====
        if (!firstName || !lastName) {
          alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –Ü–º‚Äô—è —Ç–∞ –ü—Ä—ñ–∑–≤–∏—â–µ.");
          return;
        }

        if (!amount || amount < 50) {
          alert("–í–∫–∞–∂—ñ—Ç—å —Å—É–º—É –≤—ñ–¥ 50 –≥—Ä–Ω.");
          return;
        }

        if (selectedTickets.length === 0) {
          alert("–û–±–µ—Ä—ñ—Ç—å —Ö–æ—á–∞ –± –æ–¥–∏–Ω –±—ñ–ª–µ—Ç.");
          return;
        }

        const maxTickets = Math.floor(amount / 50);
        if (selectedTickets.length > maxTickets) {
          alert(
            `–í–∏ –º–æ–∂–µ—Ç–µ –æ–±—Ä–∞—Ç–∏ –º–∞–∫—Å–∏–º—É–º ${maxTickets} –±—ñ–ª–µ—Ç(—ñ–≤) –¥–ª—è –≤–≤–µ–¥–µ–Ω–æ—ó —Å—É–º–∏ ${amount} –≥—Ä–Ω.`
          );
          return;
        }

        // ===== –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–∏—Ö —É Google Sheets =====
        const SCRIPT_URL =
          "https://script.google.com/macros/s/AKfycbxp-51Z59AwnGMbWk1hKoanZU5wA4v5n_yr-l_gyg-IPWmbFV7aUQTftbo8jk-s1mgf/exec";

        try {
          await fetch(SCRIPT_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              firstName,
              lastName,
              amount,
              tickets: selectedTickets,
            }),
          });
        } catch (err) {
          alert("–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–ø–∏—Å–∞—Ç–∏ –¥–∞–Ω—ñ –≤ Google Sheets");
          console.error(err);
          return;
        }

        // –ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ –∑–∞–ø–∏—Å—É –≤—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ Monobank
        window.open(monoJarLink, "_blank");

        // ===== –°–∫–∏–¥–∞–Ω–Ω—è —Ñ–æ—Ä–º–∏ —ñ —á–µ–∫–±–æ–∫—Å—ñ–≤ =====
        donateForm.reset();
        ticketCheckboxes.forEach((cb) => (cb.disabled = false));
      });
    </script>
  </body>
</html>
